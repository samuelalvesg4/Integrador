{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import Header from\"../components/Header\";import{registerProduct,uploadImages}from'../services/api';import useAuth from'../hooks/useAuth';import imageCompression from'browser-image-compression';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RegisterProduct=()=>{// Garante que o usuário logado é um vendedor\nuseAuth({role:'seller'});const[name,setName]=useState('');const[description,setDescription]=useState('');const[price,setPrice]=useState('');const[stock,setStock]=useState('');const[selectedFiles,setSelectedFiles]=useState([]);const[loading,setLoading]=useState(false);const navigate=useNavigate();const handleFileChange=async e=>{const files=Array.from(e.target.files);const compressedFiles=[];for(const file of files){const options={maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:true};try{const compressedFile=await imageCompression(file,options);compressedFiles.push(compressedFile);}catch(error){console.error(error);}}setSelectedFiles(compressedFiles);};const handleSubmit=async e=>{e.preventDefault();setLoading(true);try{const token=localStorage.getItem('token');if(!token){alert('Sessão expirada. Por favor, faça login novamente.');navigate('/login');setLoading(false);return;}// 1. Cadastrar o produto primeiro para obter o ID\nconst productData={name,description,price:parseFloat(price)*100,stock:parseInt(stock,10),images:[]// Começa com um array vazio de imagens\n};const newProduct=await registerProduct(productData);const productId=newProduct.id;// Assume que o backend retorna o ID do novo produto\nlet imageUrls=[];// 2. Fazer o upload das imagens usando o ID do produto recém-criado\nif(selectedFiles.length>0){const uploadResponse=await uploadImages(selectedFiles,productId);imageUrls=uploadResponse.imageUrls;// Armazena as URLs retornadas\n}alert(\"Produto cadastrado e imagens enviadas com sucesso!\");navigate('/MyProducts');}catch(error){var _error$body;console.error(\"Erro ao cadastrar produto:\",error);alert(\"Erro ao cadastrar produto: \".concat(((_error$body=error.body)===null||_error$body===void 0?void 0:_error$body.error)||error.message));}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-100\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center mt-10 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-full max-w-lg bg-white rounded-lg shadow p-8\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"flex flex-col gap-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-6 text-center text-gray-800\",children:\"Cadastrar Produto\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Nome do Produto\",value:name,onChange:e=>setName(e.target.value),required:true,className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Descri\\xE7\\xE3o\",value:description,onChange:e=>setDescription(e.target.value),required:true,className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"Pre\\xE7o (R$)\",value:price,onChange:e=>setPrice(e.target.value),required:true,className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Estoque\",value:stock,onChange:e=>setStock(e.target.value),required:true,className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,onChange:handleFileChange,className:\"border p-2 rounded w-full\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"bg-blue-600 text-white px-4 py-2 rounded-full w-full hover:bg-blue-700 transition duration-300\",children:loading?'Cadastrando...':'Cadastrar Produto'})]})})})]});};export default RegisterProduct;","map":{"version":3,"names":["React","useState","useNavigate","Header","registerProduct","uploadImages","useAuth","imageCompression","jsx","_jsx","jsxs","_jsxs","RegisterProduct","role","name","setName","description","setDescription","price","setPrice","stock","setStock","selectedFiles","setSelectedFiles","loading","setLoading","navigate","handleFileChange","e","files","Array","from","target","compressedFiles","file","options","maxSizeMB","maxWidthOrHeight","useWebWorker","compressedFile","push","error","console","handleSubmit","preventDefault","token","localStorage","getItem","alert","productData","parseFloat","parseInt","images","newProduct","productId","id","imageUrls","length","uploadResponse","_error$body","concat","body","message","className","children","onSubmit","type","placeholder","value","onChange","required","step","multiple","disabled"],"sources":["C:/Users/Samuel Alves/Desktop/Integrador/frontend/src/pages/RegisterProduct.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport Header from \"../components/Header\";\nimport { registerProduct, uploadImages } from '../services/api';\nimport useAuth from '../hooks/useAuth';\nimport imageCompression from 'browser-image-compression';\n\nconst RegisterProduct = () => {\n    // Garante que o usuário logado é um vendedor\n    useAuth({ role: 'seller' });\n\n    const [name, setName] = useState('');\n    const [description, setDescription] = useState('');\n    const [price, setPrice] = useState('');\n    const [stock, setStock] = useState('');\n    const [selectedFiles, setSelectedFiles] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const navigate = useNavigate();\n\n    const handleFileChange = async (e) => {\n        const files = Array.from(e.target.files);\n        const compressedFiles = [];\n\n        for (const file of files) {\n            const options = {\n                maxSizeMB: 1,\n                maxWidthOrHeight: 1920,\n                useWebWorker: true,\n            };\n\n            try {\n                const compressedFile = await imageCompression(file, options);\n                compressedFiles.push(compressedFile);\n            } catch (error) {\n                console.error(error);\n            }\n        }\n        setSelectedFiles(compressedFiles);\n    };\n\n    const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n        const token = localStorage.getItem('token');\n        if (!token) {\n            alert('Sessão expirada. Por favor, faça login novamente.');\n            navigate('/login');\n            setLoading(false);\n            return;\n        }\n\n        // 1. Cadastrar o produto primeiro para obter o ID\n        const productData = {\n            name,\n            description,\n            price: parseFloat(price) * 100,\n            stock: parseInt(stock, 10),\n            images: [], // Começa com um array vazio de imagens\n        };\n\n        const newProduct = await registerProduct(productData);\n        const productId = newProduct.id; // Assume que o backend retorna o ID do novo produto\n\n        let imageUrls = [];\n\n        // 2. Fazer o upload das imagens usando o ID do produto recém-criado\n        if (selectedFiles.length > 0) {\n            const uploadResponse = await uploadImages(selectedFiles, productId);\n            imageUrls = uploadResponse.imageUrls; // Armazena as URLs retornadas\n        }\n\n        alert(\"Produto cadastrado e imagens enviadas com sucesso!\");\n        navigate('/MyProducts');\n\n    } catch (error) {\n        console.error(\"Erro ao cadastrar produto:\", error);\n        alert(`Erro ao cadastrar produto: ${error.body?.error || error.message}`);\n    } finally {\n        setLoading(false);\n    }\n};\n\n    return (\n        <div className=\"min-h-screen bg-gray-100\">\n            <Header />\n            <div className=\"w-full flex justify-center mt-10 px-4 sm:px-6 lg:px-8\">\n                <div className=\"w-full max-w-lg bg-white rounded-lg shadow p-8\">\n                    <form onSubmit={handleSubmit} className=\"flex flex-col gap-4\">\n                    <h2 className=\"text-2xl font-bold mb-6 text-center text-gray-800\">Cadastrar Produto</h2>\n                        <input\n                            type=\"text\"\n                            placeholder=\"Nome do Produto\"\n                            value={name}\n                            onChange={(e) => setName(e.target.value)}\n                            required\n                            className=\"border p-2 rounded w-full\"\n                        />\n                        <textarea\n                            placeholder=\"Descrição\"\n                            value={description}\n                            onChange={(e) => setDescription(e.target.value)}\n                            required\n                            className=\"border p-2 rounded w-full\"\n                        />\n                        <input\n                            type=\"number\"\n                            step=\"0.01\"\n                            placeholder=\"Preço (R$)\"\n                            value={price}\n                            onChange={(e) => setPrice(e.target.value)}\n                            required\n                            className=\"border p-2 rounded w-full\"\n                        />\n                        <input\n                            type=\"number\"\n                            placeholder=\"Estoque\"\n                            value={stock}\n                            onChange={(e) => setStock(e.target.value)}\n                            required\n                            className=\"border p-2 rounded w-full\"\n                        />\n                        <input\n                            type=\"file\"\n                            multiple\n                            onChange={handleFileChange}\n                            className=\"border p-2 rounded w-full\"\n                        />\n                        <button\n                            type=\"submit\"\n                            disabled={loading}\n                            className=\"bg-blue-600 text-white px-4 py-2 rounded-full w-full hover:bg-blue-700 transition duration-300\"\n                        >\n                            {loading ? 'Cadastrando...' : 'Cadastrar Produto'}\n                        </button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default RegisterProduct;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}