{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Samuel Alves\\\\Desktop\\\\Integrador\\\\frontend\\\\src\\\\pages\\\\CreateProduct.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useState } from \"react\";\nimport { uploadImages, registerProduct, editProduct } from '../services/api';\nimport imageCompression from 'browser-image-compression'; // Importa a biblioteca\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function CreateProduct({\n  productToEdit,\n  onClose\n}) {\n  _s();\n  const [name, setName] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [price, setPrice] = useState(\"\");\n  const [stock, setStock] = useState(\"\");\n  const [newFiles, setNewFiles] = useState([]); // Mudado para 'newFiles' para clareza\n  const [loading, setLoading] = useState(false);\n  const isEditing = !!productToEdit;\n  useEffect(() => {\n    if (isEditing && productToEdit) {\n      setName(productToEdit.name);\n      setDescription(productToEdit.description);\n      setPrice((productToEdit.price / 100).toFixed(2));\n      setStock(productToEdit.stock);\n      // Você pode exibir as imagens existentes, mas a lógica de envio já está coberta\n    } else {\n      setName(\"\");\n      setDescription(\"\");\n      setPrice(\"\");\n      setStock(\"\");\n      setNewFiles([]);\n    }\n  }, [productToEdit, isEditing]);\n  const handleFileChange = async e => {\n    const files = Array.from(e.target.files);\n    const compressedFiles = [];\n    for (const file of files) {\n      try {\n        const compressedFile = await imageCompression(file, {\n          maxSizeMB: 1,\n          maxWidthOrHeight: 1920\n        });\n        compressedFiles.push(compressedFile);\n      } catch (error) {\n        console.error(\"Erro na compressão da imagem:\", error);\n      }\n    }\n    setNewFiles(compressedFiles);\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setLoading(true);\n    try {\n      const priceInCents = Math.round(parseFloat(price) * 100);\n      let updatedProduct = null;\n      if (isEditing) {\n        // LÓGICA DE EDIÇÃO\n        const updatedData = {\n          name,\n          description,\n          price: priceInCents,\n          stock: parseInt(stock, 10)\n        };\n        updatedProduct = await editProduct(productToEdit.id, updatedData);\n        alert(\"Produto atualizado com sucesso!\");\n\n        // Se o usuário selecionou novas imagens, faz o upload\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, productToEdit.id);\n        }\n      } else {\n        // LÓGICA DE CADASTRO\n        const newProductData = {\n          name,\n          description,\n          price: priceInCents,\n          stock: parseInt(stock, 10),\n          images: []\n        };\n        updatedProduct = await registerProduct(newProductData);\n\n        // Se o usuário selecionou imagens no cadastro, faz o upload usando o ID do novo produto\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, updatedProduct.id);\n        }\n        alert(\"Produto cadastrado com sucesso!\");\n      }\n      onClose(); // Fecha o modal ou componente\n    } catch (error) {\n      var _error$body;\n      console.error(\"Erro no cadastro/edição:\", error);\n      alert(\"Erro: \" + (((_error$body = error.body) === null || _error$body === void 0 ? void 0 : _error$body.error) || error.message));\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-md mx-auto mt-8 p-6 bg-white rounded shadow\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-2xl font-bold mb-4\",\n      children: isEditing ? \"Editar Produto\" : \"Cadastrar Produto\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      className: \"flex flex-col gap-3\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        placeholder: \"Nome do Produto\",\n        value: name,\n        onChange: e => setName(e.target.value),\n        required: true,\n        className: \"border p-2 rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n        placeholder: \"Descri\\xE7\\xE3o\",\n        value: description,\n        onChange: e => setDescription(e.target.value),\n        required: true,\n        className: \"border p-2 rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        placeholder: \"Quantidade em estoque\",\n        value: stock,\n        onChange: e => setStock(e.target.value),\n        required: true,\n        className: \"border p-2 rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        step: \"0.01\",\n        placeholder: \"Valor (R$)\",\n        value: price,\n        onChange: e => setPrice(e.target.value),\n        required: true,\n        className: \"border p-2 rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        accept: \"image/*\",\n        onChange: handleFileChange,\n        multiple: true,\n        className: \"border p-2 rounded\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"submit\",\n        className: \"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\",\n        disabled: loading,\n        children: loading ? isEditing ? 'Atualizando...' : 'Cadastrando...' : isEditing ? 'Atualizar' : 'Cadastrar'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(CreateProduct, \"SEGZPlM3/w+3uJweMHbM/eAJ0TY=\");\n_c = CreateProduct;\nvar _c;\n$RefreshReg$(_c, \"CreateProduct\");","map":{"version":3,"names":["useEffect","useState","uploadImages","registerProduct","editProduct","imageCompression","jsxDEV","_jsxDEV","CreateProduct","productToEdit","onClose","_s","name","setName","description","setDescription","price","setPrice","stock","setStock","newFiles","setNewFiles","loading","setLoading","isEditing","toFixed","handleFileChange","e","files","Array","from","target","compressedFiles","file","compressedFile","maxSizeMB","maxWidthOrHeight","push","error","console","handleSubmit","preventDefault","priceInCents","Math","round","parseFloat","updatedProduct","updatedData","parseInt","id","alert","length","newProductData","images","_error$body","body","message","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","type","placeholder","value","onChange","required","step","accept","multiple","disabled","_c","$RefreshReg$"],"sources":["C:/Users/Samuel Alves/Desktop/Integrador/frontend/src/pages/CreateProduct.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { uploadImages, registerProduct, editProduct } from '../services/api';\nimport imageCompression from 'browser-image-compression'; // Importa a biblioteca\n\nexport default function CreateProduct({ productToEdit, onClose }) {\n  const [name, setName] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [price, setPrice] = useState(\"\");\n  const [stock, setStock] = useState(\"\");\n  const [newFiles, setNewFiles] = useState([]); // Mudado para 'newFiles' para clareza\n  const [loading, setLoading] = useState(false);\n  \n  const isEditing = !!productToEdit;\n\n  useEffect(() => {\n    if (isEditing && productToEdit) {\n      setName(productToEdit.name);\n      setDescription(productToEdit.description);\n      setPrice((productToEdit.price / 100).toFixed(2));\n      setStock(productToEdit.stock);\n      // Você pode exibir as imagens existentes, mas a lógica de envio já está coberta\n    } else {\n      setName(\"\");\n      setDescription(\"\");\n      setPrice(\"\");\n      setStock(\"\");\n      setNewFiles([]);\n    }\n  }, [productToEdit, isEditing]);\n  \n  const handleFileChange = async (e) => {\n    const files = Array.from(e.target.files);\n    const compressedFiles = [];\n    for (const file of files) {\n      try {\n        const compressedFile = await imageCompression(file, {\n          maxSizeMB: 1,\n          maxWidthOrHeight: 1920,\n        });\n        compressedFiles.push(compressedFile);\n      } catch (error) {\n        console.error(\"Erro na compressão da imagem:\", error);\n      }\n    }\n    setNewFiles(compressedFiles);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const priceInCents = Math.round(parseFloat(price) * 100);\n      let updatedProduct = null;\n\n      if (isEditing) {\n        // LÓGICA DE EDIÇÃO\n        const updatedData = { name, description, price: priceInCents, stock: parseInt(stock, 10) };\n        updatedProduct = await editProduct(productToEdit.id, updatedData);\n        alert(\"Produto atualizado com sucesso!\");\n\n        // Se o usuário selecionou novas imagens, faz o upload\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, productToEdit.id);\n        }\n\n      } else {\n        // LÓGICA DE CADASTRO\n        const newProductData = { name, description, price: priceInCents, stock: parseInt(stock, 10), images: [] };\n        updatedProduct = await registerProduct(newProductData);\n        \n        // Se o usuário selecionou imagens no cadastro, faz o upload usando o ID do novo produto\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, updatedProduct.id);\n        }\n\n        alert(\"Produto cadastrado com sucesso!\");\n      }\n\n      onClose(); // Fecha o modal ou componente\n    } catch (error) {\n      console.error(\"Erro no cadastro/edição:\", error);\n      alert(\"Erro: \" + (error.body?.error || error.message));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-md mx-auto mt-8 p-6 bg-white rounded shadow\">\n      <h2 className=\"text-2xl font-bold mb-4\">{isEditing ? \"Editar Produto\" : \"Cadastrar Produto\"}</h2>\n      <form onSubmit={handleSubmit} className=\"flex flex-col gap-3\">\n        <input\n          type=\"text\"\n          placeholder=\"Nome do Produto\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <textarea\n          placeholder=\"Descrição\"\n          value={description}\n          onChange={(e) => setDescription(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"number\"\n          placeholder=\"Quantidade em estoque\"\n          value={stock}\n          onChange={(e) => setStock(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"number\"\n          step=\"0.01\"\n          placeholder=\"Valor (R$)\"\n          value={price}\n          onChange={(e) => setPrice(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={handleFileChange}\n          multiple\n          className=\"border p-2 rounded\"\n        />\n        <button\n          type=\"submit\"\n          className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n          disabled={loading}\n        >\n          {loading ? (isEditing ? 'Atualizando...' : 'Cadastrando...') : (isEditing ? 'Atualizar' : 'Cadastrar')}\n        </button>\n      </form>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}