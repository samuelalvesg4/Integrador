{"ast":null,"code":"import{useEffect,useState}from\"react\";import{uploadImages,registerProduct,editProduct}from'../services/api';import imageCompression from'browser-image-compression';// Importa a biblioteca\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function CreateProduct(_ref){let{productToEdit,onClose}=_ref;const[name,setName]=useState(\"\");const[description,setDescription]=useState(\"\");const[price,setPrice]=useState(\"\");const[stock,setStock]=useState(\"\");const[newFiles,setNewFiles]=useState([]);// Mudado para 'newFiles' para clareza\nconst[loading,setLoading]=useState(false);const isEditing=!!productToEdit;useEffect(()=>{if(isEditing&&productToEdit){setName(productToEdit.name);setDescription(productToEdit.description);setPrice((productToEdit.price/100).toFixed(2));setStock(productToEdit.stock);// Você pode exibir as imagens existentes, mas a lógica de envio já está coberta\n}else{setName(\"\");setDescription(\"\");setPrice(\"\");setStock(\"\");setNewFiles([]);}},[productToEdit,isEditing]);const handleFileChange=async e=>{const files=Array.from(e.target.files);const compressedFiles=[];for(const file of files){try{const compressedFile=await imageCompression(file,{maxSizeMB:1,maxWidthOrHeight:1920});compressedFiles.push(compressedFile);}catch(error){console.error(\"Erro na compressão da imagem:\",error);}}setNewFiles(compressedFiles);};const handleSubmit=async e=>{e.preventDefault();setLoading(true);try{const priceInCents=Math.round(parseFloat(price)*100);let updatedProduct=null;if(isEditing){// LÓGICA DE EDIÇÃO\nconst updatedData={name,description,price:priceInCents,stock:parseInt(stock,10)};updatedProduct=await editProduct(productToEdit.id,updatedData);alert(\"Produto atualizado com sucesso!\");// Se o usuário selecionou novas imagens, faz o upload\nif(newFiles.length>0){await uploadImages(newFiles,productToEdit.id);}}else{// LÓGICA DE CADASTRO\nconst newProductData={name,description,price:priceInCents,stock:parseInt(stock,10),images:[]};updatedProduct=await registerProduct(newProductData);// Se o usuário selecionou imagens no cadastro, faz o upload usando o ID do novo produto\nif(newFiles.length>0){await uploadImages(newFiles,updatedProduct.id);}alert(\"Produto cadastrado com sucesso!\");}onClose();// Fecha o modal ou componente\n}catch(error){var _error$body;console.error(\"Erro no cadastro/edição:\",error);alert(\"Erro: \"+(((_error$body=error.body)===null||_error$body===void 0?void 0:_error$body.error)||error.message));}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto mt-8 p-6 bg-white rounded shadow\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold mb-4\",children:isEditing?\"Editar Produto\":\"Cadastrar Produto\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"flex flex-col gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Nome do Produto\",value:name,onChange:e=>setName(e.target.value),required:true,className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Descri\\xE7\\xE3o\",value:description,onChange:e=>setDescription(e.target.value),required:true,className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Quantidade em estoque\",value:stock,onChange:e=>setStock(e.target.value),required:true,className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.01\",placeholder:\"Valor (R$)\",value:price,onChange:e=>setPrice(e.target.value),required:true,className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:handleFileChange,multiple:true,className:\"border p-2 rounded\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\",disabled:loading,children:loading?isEditing?'Atualizando...':'Cadastrando...':isEditing?'Atualizar':'Cadastrar'})]})]});}","map":{"version":3,"names":["useEffect","useState","uploadImages","registerProduct","editProduct","imageCompression","jsx","_jsx","jsxs","_jsxs","CreateProduct","_ref","productToEdit","onClose","name","setName","description","setDescription","price","setPrice","stock","setStock","newFiles","setNewFiles","loading","setLoading","isEditing","toFixed","handleFileChange","e","files","Array","from","target","compressedFiles","file","compressedFile","maxSizeMB","maxWidthOrHeight","push","error","console","handleSubmit","preventDefault","priceInCents","Math","round","parseFloat","updatedProduct","updatedData","parseInt","id","alert","length","newProductData","images","_error$body","body","message","className","children","onSubmit","type","placeholder","value","onChange","required","step","accept","multiple","disabled"],"sources":["C:/Users/Samuel Alves/Desktop/Integrador/frontend/src/pages/CreateProduct.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { uploadImages, registerProduct, editProduct } from '../services/api';\nimport imageCompression from 'browser-image-compression'; // Importa a biblioteca\n\nexport default function CreateProduct({ productToEdit, onClose }) {\n  const [name, setName] = useState(\"\");\n  const [description, setDescription] = useState(\"\");\n  const [price, setPrice] = useState(\"\");\n  const [stock, setStock] = useState(\"\");\n  const [newFiles, setNewFiles] = useState([]); // Mudado para 'newFiles' para clareza\n  const [loading, setLoading] = useState(false);\n  \n  const isEditing = !!productToEdit;\n\n  useEffect(() => {\n    if (isEditing && productToEdit) {\n      setName(productToEdit.name);\n      setDescription(productToEdit.description);\n      setPrice((productToEdit.price / 100).toFixed(2));\n      setStock(productToEdit.stock);\n      // Você pode exibir as imagens existentes, mas a lógica de envio já está coberta\n    } else {\n      setName(\"\");\n      setDescription(\"\");\n      setPrice(\"\");\n      setStock(\"\");\n      setNewFiles([]);\n    }\n  }, [productToEdit, isEditing]);\n  \n  const handleFileChange = async (e) => {\n    const files = Array.from(e.target.files);\n    const compressedFiles = [];\n    for (const file of files) {\n      try {\n        const compressedFile = await imageCompression(file, {\n          maxSizeMB: 1,\n          maxWidthOrHeight: 1920,\n        });\n        compressedFiles.push(compressedFile);\n      } catch (error) {\n        console.error(\"Erro na compressão da imagem:\", error);\n      }\n    }\n    setNewFiles(compressedFiles);\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setLoading(true);\n\n    try {\n      const priceInCents = Math.round(parseFloat(price) * 100);\n      let updatedProduct = null;\n\n      if (isEditing) {\n        // LÓGICA DE EDIÇÃO\n        const updatedData = { name, description, price: priceInCents, stock: parseInt(stock, 10) };\n        updatedProduct = await editProduct(productToEdit.id, updatedData);\n        alert(\"Produto atualizado com sucesso!\");\n\n        // Se o usuário selecionou novas imagens, faz o upload\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, productToEdit.id);\n        }\n\n      } else {\n        // LÓGICA DE CADASTRO\n        const newProductData = { name, description, price: priceInCents, stock: parseInt(stock, 10), images: [] };\n        updatedProduct = await registerProduct(newProductData);\n        \n        // Se o usuário selecionou imagens no cadastro, faz o upload usando o ID do novo produto\n        if (newFiles.length > 0) {\n          await uploadImages(newFiles, updatedProduct.id);\n        }\n\n        alert(\"Produto cadastrado com sucesso!\");\n      }\n\n      onClose(); // Fecha o modal ou componente\n    } catch (error) {\n      console.error(\"Erro no cadastro/edição:\", error);\n      alert(\"Erro: \" + (error.body?.error || error.message));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"max-w-md mx-auto mt-8 p-6 bg-white rounded shadow\">\n      <h2 className=\"text-2xl font-bold mb-4\">{isEditing ? \"Editar Produto\" : \"Cadastrar Produto\"}</h2>\n      <form onSubmit={handleSubmit} className=\"flex flex-col gap-3\">\n        <input\n          type=\"text\"\n          placeholder=\"Nome do Produto\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <textarea\n          placeholder=\"Descrição\"\n          value={description}\n          onChange={(e) => setDescription(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"number\"\n          placeholder=\"Quantidade em estoque\"\n          value={stock}\n          onChange={(e) => setStock(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"number\"\n          step=\"0.01\"\n          placeholder=\"Valor (R$)\"\n          value={price}\n          onChange={(e) => setPrice(e.target.value)}\n          required\n          className=\"border p-2 rounded\"\n        />\n        <input\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={handleFileChange}\n          multiple\n          className=\"border p-2 rounded\"\n        />\n        <button\n          type=\"submit\"\n          className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n          disabled={loading}\n        >\n          {loading ? (isEditing ? 'Atualizando...' : 'Cadastrando...') : (isEditing ? 'Atualizar' : 'Cadastrar')}\n        </button>\n      </form>\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}